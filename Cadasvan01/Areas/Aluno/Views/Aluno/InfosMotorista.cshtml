@model Cadasvan01.Areas.Aluno.Controllers.InfosMotoristaViewModel

<div>
    <h2>Informações do Motorista</h2>
    <hr />
    <div class="containerConteudo avaliacao-container">
        <p><strong>Avaliação:</strong></p>
        <p class="avaliacao-estrelas">
            @if (Model.MediaAvaliacoes > 0)
            {
                @for (int i = 0; i < Math.Floor(Model.MediaAvaliacoes); i++)
                {
                    <i class='bx bxs-star'></i>
                }
                @if (Model.MediaAvaliacoes % 1 != 0)
                {
                    <i class='bx bx-star-half'></i>
                }
                @for (int i = 0; i < (5 - Math.Ceiling(Model.MediaAvaliacoes)); i++)
                {
                    <i class='bx bx-star'></i>
                }
            <p><strong>Média:</strong> @Model.MediaAvaliacoes.ToString("0.0") estrelas</p>
            }
            else
            {
            <p>Nenhuma avaliação foi feita ainda.</p>
            }
        </p>
    </div>

    <div>
        <p><strong>Nome Completo:</strong> @Model.Motorista.Nome @Model.Motorista.Sobrenome</p>
        <p><strong>Email:</strong> @Model.Motorista.Email</p>
        <p><strong>Telefone:</strong> @Model.Motorista.Celular1</p>
        @if (Model.Motorista.Celular2 != null && Model.Motorista.Celular2 != Model.Motorista.Celular1)
        {
            <p><strong>Telefone:</strong> @Model.Motorista.Celular2</p>
        }
        <p><strong>CNH:</strong> @Model.Motorista.CNH</p>
    </div>



    @if (Model.Avaliacao != null && Model.Avaliacao.AvaliacaoEstrelas > 0)
    {
        <div class="containerConteudo avaliacaodada-container">
            <h4>Sua avaliação:</h4>
            <p class="avaliacao-estrelas">
                @for (int i = 0; i < Model.Avaliacao.AvaliacaoEstrelas; i++)
                {
                    <i class='bx bxs-star'></i>
                }
                @for (int i = Model.Avaliacao.AvaliacaoEstrelas; i < 5; i++)
                {
                    <i class='bx bx-star'></i>
                }
            </p>
            <p class="comentario"><strong>Comentário:</strong> @Model.Avaliacao.Opiniao</p>
            <button id="editarAvaliacaoBtn" class="btn btn-custom">Editar Avaliação</button>
        </div>
    }
    else
    {
        <button id="avaliarBtn" class="btnC btn-custom">Avaliar Motorista</button>
    }

    <button id="desvincularBtn" class="btnC btn-danger">Desvincular</button>
</div>

<!-- Modal de Avaliação -->
<div id="avaliacaoModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Avaliar Motorista</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="avaliacaoForm" method="post" asp-action="AvaliarMotorista" asp-controller="Aluno" asp-area="Aluno">
                    <div class="form-group">
                        <label for="estrelas">Estrelas</label>
                        <select id="estrelas" name="AvaliacaoEstrelas" class="form-control">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="opiniao">Opinião</label>
                        <textarea id="opiniao" name="Opiniao" class="form-control" rows="4"></textarea>
                    </div>
                    <input type="hidden" name="MotoristaId" value="@Model.Motorista.Id" />
                    <button type="submit" class="btnC btn-custom" style="margin-top: 10px">Enviar Avaliação</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação -->
<div id="confirmModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirmação</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja desvincular do motorista? Digite "Tenho certeza" abaixo para confirmar:</p>
                <input type="text" id="confirmInput" class="form-control" />
            </div>
            <div class="modal-footer">
                <button type="button" id="confirmBtn" class="btnC btn-danger">Confirmar</button>
                <button type="button" class="btnC btn-secondary" data-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#avaliarBtn').on('click', function () {
                $('#avaliacaoModal').modal('show');
            });

            $('#editarAvaliacaoBtn').on('click', function () {
                $('#avaliacaoModal').modal('show');
                // Preencher o modal com os dados da avaliação existente
                var avaliacaoEstrelas = @Model.Avaliacao != null ? '@Model.Avaliacao.AvaliacaoEstrelas' : 'null';
                var opiniao = @Model.Avaliacao != null ? '@Model.Avaliacao.Opiniao' : 'null';

                if (avaliacaoEstrelas !== 'null' && opiniao !== 'null') {
                    $('#estrelas').val(avaliacaoEstrelas);
                    $('#opiniao').val(opiniao);
                }
            });

            $('#desvincularBtn').on('click', function () {
                $('#confirmModal').modal('show');
            });

            $('#confirmBtn').on('click', function () {
                var input = $('#confirmInput').val();
                if (input === "Tenho certeza") {
                    $('#desvincularForm').submit();
                } else {
                    alert("Você precisa digitar 'Tenho certeza' para confirmar.");
                }
            });
        });
    </script>
}

<form id="desvincularForm" method="post" asp-area="Aluno" asp-controller="AlunoCodigo" asp-action="DesvincularMotorista"></form>
